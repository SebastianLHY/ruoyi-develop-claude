#!/bin/bash
# ============================================================
# 自动化开发流程脚本 - Linux/Mac版本
# 用途: 自动执行完整的开发流程
# 使用方法: ./auto-dev.sh [模块名称]
# ============================================================

# 获取CLI工具路径
CLI_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
JDC="$CLI_DIR/jdc.sh"

# 获取模块名称参数
MODULE_NAME="${1:-默认模块}"

echo "============================================================"
echo "自动化开发流程"
echo "模块名称: $MODULE_NAME"
echo "============================================================"
echo

# 错误处理函数
handle_error() {
    echo "错误: $1执行失败"
    echo "============================================================"
    echo "开发流程中断！"
    echo "============================================================"
    exit 1
}

# 步骤1: 需求澄清与分析
echo "[步骤 1/11] 需求澄清与分析..."
"$JDC" step1 "$MODULE_NAME" || handle_error "步骤1"
echo

# 步骤2: 技术设计与模块规划
echo "[步骤 2/11] 技术设计与模块规划..."
"$JDC" step2 || handle_error "步骤2"
echo

# 步骤3: Git初始化
echo "[步骤 3/11] Git初始化..."
"$JDC" step3 || handle_error "步骤3"
echo

# 步骤4: 文档初始化
echo "[步骤 4/11] 文档初始化..."
"$JDC" step4 || handle_error "步骤4"
echo

# 步骤5: 数据库设计
echo "[步骤 5/11] 数据库设计..."
"$JDC" step5 || handle_error "步骤5"
echo

# 步骤5.5: 代码生成方式选择
echo "[步骤 5.5/11] 代码生成方式选择..."
"$JDC" step5.5 || handle_error "步骤5.5"
echo

# 步骤6: 后端开发
echo "[步骤 6/11] 后端开发..."
"$JDC" step6 || handle_error "步骤6"
echo

# 步骤7: 前端开发
echo "[步骤 7/11] 前端开发..."
"$JDC" step7 || handle_error "步骤7"
echo

# 步骤8: 测试验证
echo "[步骤 8/11] 测试验证..."
"$JDC" step8 || handle_error "步骤8"
echo

# 步骤9: 代码质量检查
echo "[步骤 9/11] 代码质量检查..."
"$JDC" step9 || handle_error "步骤9"
echo

# 步骤10: 文档更新
echo "[步骤 10/11] 文档更新..."
"$JDC" step10 || handle_error "步骤10"
echo

# 步骤11: Git提交与合并
echo "[步骤 11/11] Git提交与合并..."
"$JDC" step11 || handle_error "步骤11"
echo

echo "============================================================"
echo "开发流程完成！"
echo "============================================================"
