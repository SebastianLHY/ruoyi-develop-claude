# 🔢 错误码体系与快速查询

> **版本**: v2.18.0  
> **最后更新**: 2026-01-29  
> **用途**: 标准化错误码体系、错误信息规范、快速查询手册  
> **特点**: 分类清晰、易于查询、支持扩展

---

## 📋 目录

- [错误码体系概述](#错误码体系概述)
- [错误码规范](#错误码规范)
- [错误码分类](#错误码分类)
- [快速查询索引](#快速查询索引)
- [错误处理最佳实践](#错误处理最佳实践)
- [自定义错误码](#自定义错误码)

---

## 📊 错误码体系概述

### 设计原则

| 原则 | 说明 | 示例 |
|------|------|------|
| **分类清晰** | 按业务模块和错误类型分类 | DEV-001, SQL-001 |
| **易于理解** | 错误信息清晰明确 | "数据库连接失败" |
| **便于排查** | 包含定位信息 | 文件名、行号、方法名 |
| **国际化支持** | 支持多语言错误信息 | zh_CN, en_US |
| **可扩展** | 预留扩展空间 | 每类预留100个编号 |

### 错误码结构

```
[模块前缀]-[错误类型]-[序号]

示例: DEV-SQL-001
├─ DEV: 开发流程模块
├─ SQL: 错误类型（SQL相关）
└─ 001: 序号（该类型下的第1个错误）
```

---

## 🏗️ 错误码规范

### 错误码格式

```
格式: [MODULE]-[TYPE]-[NUMBER]

MODULE: 模块前缀（3-4个字符）
  - DEV: 开发流程
  - GIT: Git操作
  - SQL: 数据库
  - CODE: 代码生成
  - TEST: 测试
  - PERF: 性能
  - DOC: 文档

TYPE: 错误类型（2-4个字符）
  - CONN: 连接错误
  - AUTH: 认证错误
  - PERM: 权限错误
  - DATA: 数据错误
  - CONF: 配置错误

NUMBER: 序号（3位数字，001-999）
```

### 错误信息结构

```json
{
  "code": "DEV-SQL-001",
  "type": "DATABASE_ERROR",
  "severity": "ERROR",
  "message": "数据库连接失败",
  "details": "无法连接到数据库 localhost:3306/ruoyi",
  "solution": "请检查数据库服务是否启动，配置是否正确",
  "timestamp": "2026-01-29T15:30:45Z",
  "context": {
    "step": "步骤5",
    "file": "application.yml",
    "line": 23
  }
}
```

---

## 🗂️ 错误码分类

### 1. 开发流程错误 (DEV-xxx-xxx)

#### DEV-STEP-xxx: 步骤执行错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **DEV-STEP-001** | 步骤1需求澄清失败 | 需求信息不完整 | 补充必填的需求信息 |
| **DEV-STEP-002** | 步骤2技术设计失败 | 设计方案不合理 | 重新设计或咨询架构师 |
| **DEV-STEP-003** | 步骤3 Git初始化失败 | Git仓库不存在或无权限 | 检查Git配置和权限 |
| **DEV-STEP-004** | 步骤4文档初始化失败 | 文档目录创建失败 | 检查文件系统权限 |
| **DEV-STEP-005** | 步骤5数据库设计失败 | SQL执行失败 | 检查SQL语法和数据库连接 |
| **DEV-STEP-006** | 步骤6后端开发失败 | 代码生成或编译失败 | 查看详细错误日志 |
| **DEV-STEP-007** | 步骤7前端开发失败 | 前端代码生成失败 | 检查前端环境配置 |
| **DEV-STEP-008** | 步骤8测试验证失败 | 测试用例执行失败 | 查看测试报告定位问题 |
| **DEV-STEP-009** | 步骤9质量检查失败 | 代码质量不达标 | 修复质量问题后重新检查 |
| **DEV-STEP-010** | 步骤10文档更新失败 | 文档格式错误 | 检查文档格式和内容 |
| **DEV-STEP-011** | 步骤11 Git提交失败 | 提交冲突或权限问题 | 解决冲突或检查权限 |

#### DEV-DEP-xxx: 依赖检查错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **DEV-DEP-001** | 必需依赖检查失败 | 前置步骤未完成 | 先完成前置步骤 |
| **DEV-DEP-002** | 推荐依赖检查失败 | 建议的前置步骤未完成 | 确认是否继续或完成前置步骤 |
| **DEV-DEP-003** | 循环依赖检测 | 步骤间存在循环依赖 | 调整步骤执行顺序 |
| **DEV-DEP-004** | 依赖版本不兼容 | 依赖包版本冲突 | 升级或降级依赖版本 |

#### DEV-ROLL-xxx: 回滚错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **DEV-ROLL-001** | 自动回滚失败 | 回滚操作执行失败 | 手动回滚或恢复备份 |
| **DEV-ROLL-002** | 检查点不存在 | 指定的检查点未找到 | 选择其他检查点或重新开始 |
| **DEV-ROLL-003** | 检查点损坏 | 检查点文件损坏 | 使用备份或重新开始 |
| **DEV-ROLL-004** | 回滚超时 | 回滚操作超时 | 增加超时时间或手动处理 |

---

### 2. Git操作错误 (GIT-xxx-xxx)

#### GIT-CONN-xxx: Git连接错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **GIT-CONN-001** | Git仓库连接失败 | 网络问题或仓库地址错误 | 检查网络和仓库地址 |
| **GIT-CONN-002** | Git认证失败 | 用户名密码错误或SSH密钥无效 | 检查认证信息 |
| **GIT-CONN-003** | Git仓库不存在 | 远程仓库不存在 | 创建仓库或检查地址 |

#### GIT-OPER-xxx: Git操作错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **GIT-OPER-001** | Git分支创建失败 | 分支名冲突或权限不足 | 使用其他分支名或检查权限 |
| **GIT-OPER-002** | Git提交失败 | 提交信息为空或文件冲突 | 添加提交信息或解决冲突 |
| **GIT-OPER-003** | Git推送失败 | 远程分支保护或权限不足 | 检查分支保护规则和权限 |
| **GIT-OPER-004** | Git合并冲突 | 文件内容冲突 | 手动解决冲突 |
| **GIT-OPER-005** | Git拉取失败 | 本地修改未提交 | 提交或暂存本地修改 |
| **GIT-OPER-006** | Git标签创建失败 | 标签名冲突 | 使用其他标签名 |

---

### 3. 数据库错误 (SQL-xxx-xxx)

#### SQL-CONN-xxx: 数据库连接错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **SQL-CONN-001** | 数据库连接失败 | 数据库服务未启动或配置错误 | 启动数据库服务，检查配置 |
| **SQL-CONN-002** | 数据库认证失败 | 用户名密码错误 | 检查数据库用户名密码 |
| **SQL-CONN-003** | 数据库不存在 | 指定的数据库不存在 | 创建数据库或检查配置 |
| **SQL-CONN-004** | 连接池耗尽 | 连接数超过最大限制 | 增加连接池大小或释放连接 |
| **SQL-CONN-005** | 连接超时 | 数据库响应超时 | 检查网络或增加超时时间 |

#### SQL-EXEC-xxx: SQL执行错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **SQL-EXEC-001** | SQL语法错误 | SQL语句语法不正确 | 检查SQL语法 |
| **SQL-EXEC-002** | 表不存在 | 查询的表不存在 | 创建表或检查表名 |
| **SQL-EXEC-003** | 字段不存在 | 查询的字段不存在 | 检查字段名 |
| **SQL-EXEC-004** | 主键冲突 | 插入的主键已存在 | 使用其他主键值 |
| **SQL-EXEC-005** | 唯一约束冲突 | 插入的唯一字段值已存在 | 使用其他值 |
| **SQL-EXEC-006** | 外键约束冲突 | 外键引用的记录不存在 | 先插入关联记录 |
| **SQL-EXEC-007** | 非空约束冲突 | 必填字段为空 | 提供字段值 |
| **SQL-EXEC-008** | 数据类型错误 | 字段类型不匹配 | 转换数据类型 |
| **SQL-EXEC-009** | 权限不足 | 数据库用户权限不足 | 授予相应权限 |
| **SQL-EXEC-010** | 事务回滚 | 事务执行失败 | 检查事务逻辑 |

#### SQL-PERF-xxx: 数据库性能错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **SQL-PERF-001** | 慢查询检测 | 查询执行时间超过阈值 | 优化SQL或添加索引 |
| **SQL-PERF-002** | 全表扫描 | 查询未使用索引 | 添加合适的索引 |
| **SQL-PERF-003** | N+1查询问题 | 循环中执行查询 | 使用批量查询或JOIN |
| **SQL-PERF-004** | 锁等待超时 | 等待锁超时 | 优化事务或减少锁竞争 |

---

### 4. 代码生成错误 (CODE-xxx-xxx)

#### CODE-GEN-xxx: 代码生成错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **CODE-GEN-001** | 代码生成器不可用 | 生成器服务未启动 | 启动生成器服务 |
| **CODE-GEN-002** | 模板文件缺失 | 代码模板文件不存在 | 恢复模板文件 |
| **CODE-GEN-003** | 配置文件错误 | 生成器配置不正确 | 检查配置文件 |
| **CODE-GEN-004** | 生成超时 | 代码生成超时 | 增加超时时间或使用AI生成 |
| **CODE-GEN-005** | 表结构解析失败 | 无法解析数据库表结构 | 检查表是否存在 |

#### CODE-COMP-xxx: 代码编译错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **CODE-COMP-001** | Java编译错误 | 代码语法错误 | 修复语法错误 |
| **CODE-COMP-002** | 依赖缺失 | Maven依赖未下载 | 执行 mvn clean install |
| **CODE-COMP-003** | 类未找到 | 引用的类不存在 | 检查导入语句 |
| **CODE-COMP-004** | 方法未找到 | 调用的方法不存在 | 检查方法名和参数 |
| **CODE-COMP-005** | 类型不匹配 | 变量类型不匹配 | 转换类型或修改定义 |

#### CODE-REV-xxx: 代码审查错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **CODE-REV-001** | Critical问题检测 | 发现严重代码问题 | 修复Critical问题 |
| **CODE-REV-002** | 安全漏洞检测 | 发现安全漏洞 | 修复安全漏洞 |
| **CODE-REV-003** | 代码规范违反 | 代码不符合规范 | 按规范修改代码 |
| **CODE-REV-004** | 性能问题检测 | 发现性能问题 | 优化代码性能 |

---

### 5. 测试错误 (TEST-xxx-xxx)

#### TEST-UNIT-xxx: 单元测试错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **TEST-UNIT-001** | 单元测试失败 | 测试用例执行失败 | 修复代码或测试用例 |
| **TEST-UNIT-002** | 断言失败 | 实际结果与预期不符 | 检查业务逻辑 |
| **TEST-UNIT-003** | 测试超时 | 测试执行超时 | 优化代码或增加超时时间 |
| **TEST-UNIT-004** | Mock失败 | Mock对象创建失败 | 检查Mock配置 |
| **TEST-UNIT-005** | 测试覆盖率不足 | 代码覆盖率低于阈值 | 补充测试用例 |

#### TEST-INTG-xxx: 集成测试错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **TEST-INTG-001** | 接口测试失败 | API接口返回错误 | 检查接口实现 |
| **TEST-INTG-002** | 数据库测试失败 | 数据库操作失败 | 检查数据库配置 |
| **TEST-INTG-003** | 事务测试失败 | 事务未正确回滚 | 检查事务配置 |

---

### 6. 性能错误 (PERF-xxx-xxx)

#### PERF-SQL-xxx: SQL性能错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **PERF-SQL-001** | 慢查询告警 | 查询时间超过阈值 | 优化SQL或添加索引 |
| **PERF-SQL-002** | 索引缺失 | 查询字段缺少索引 | 添加索引 |
| **PERF-SQL-003** | N+1查询 | 循环中执行查询 | 使用批量查询 |

#### PERF-CODE-xxx: 代码性能错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **PERF-CODE-001** | 算法复杂度过高 | 存在O(n²)及以上算法 | 优化算法 |
| **PERF-CODE-002** | 内存泄漏风险 | 资源未正确释放 | 释放资源 |
| **PERF-CODE-003** | 缓存未命中 | 缓存命中率低 | 优化缓存策略 |

#### PERF-FE-xxx: 前端性能错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **PERF-FE-001** | 打包体积过大 | 前端打包文件过大 | 代码分割或压缩 |
| **PERF-FE-002** | 重复渲染 | 组件不必要的重渲染 | 优化组件渲染 |
| **PERF-FE-003** | 请求过多 | 网络请求次数过多 | 合并请求或使用缓存 |

---

### 7. 文档错误 (DOC-xxx-xxx)

#### DOC-GEN-xxx: 文档生成错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **DOC-GEN-001** | 文档生成失败 | 模板或数据错误 | 检查模板和数据 |
| **DOC-GEN-002** | 文档格式错误 | Markdown格式不正确 | 修正格式 |
| **DOC-GEN-003** | 文档路径错误 | 文档目录不存在 | 创建目录 |

---

## 🔍 快速查询索引

### 按错误码查询

```markdown
# 快速查询格式
错误码: DEV-SQL-001

# 查询方法
1. 在本文档中搜索错误码
2. 或使用命令: /search DEV-SQL-001
3. 或访问: #dev-sql-001
```

### 按关键词查询

| 关键词 | 相关错误码 | 快速跳转 |
|--------|-----------|---------|
| **数据库连接** | SQL-CONN-001, SQL-CONN-002 | [查看](#sql-conn-xxx-数据库连接错误) |
| **SQL语法** | SQL-EXEC-001 | [查看](#sql-exec-xxx-sql执行错误) |
| **编译错误** | CODE-COMP-001 | [查看](#code-comp-xxx-代码编译错误) |
| **测试失败** | TEST-UNIT-001 | [查看](#test-unit-xxx-单元测试错误) |
| **Git冲突** | GIT-OPER-004 | [查看](#git-oper-xxx-git操作错误) |
| **性能问题** | PERF-SQL-001, PERF-CODE-001 | [查看](#6-性能错误-perf-xxx-xxx) |
| **代码生成** | CODE-GEN-001 | [查看](#code-gen-xxx-代码生成错误) |
| **回滚失败** | DEV-ROLL-001 | [查看](#dev-roll-xxx-回滚错误) |

### 按步骤查询

| 步骤 | 常见错误码 | 快速跳转 |
|------|-----------|---------|
| **步骤1** | DEV-STEP-001 | [查看](#dev-step-xxx-步骤执行错误) |
| **步骤2** | DEV-STEP-002 | [查看](#dev-step-xxx-步骤执行错误) |
| **步骤5** | DEV-STEP-005, SQL-CONN-001, SQL-EXEC-001 | [查看](#3-数据库错误-sql-xxx-xxx) |
| **步骤6** | DEV-STEP-006, CODE-GEN-001, CODE-COMP-001 | [查看](#4-代码生成错误-code-xxx-xxx) |
| **步骤7** | DEV-STEP-007, PERF-FE-001 | [查看](#perf-fe-xxx-前端性能错误) |
| **步骤8** | DEV-STEP-008, TEST-UNIT-001 | [查看](#5-测试错误-test-xxx-xxx) |
| **步骤11** | DEV-STEP-011, GIT-OPER-002, GIT-OPER-004 | [查看](#2-git操作错误-git-xxx-xxx) |

---

## 💡 错误处理最佳实践

### 1. 错误捕获

```java
// ✅ 推荐：使用统一异常处理
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(BusinessException.class)
    public R<Void> handleBusinessException(BusinessException e) {
        log.error("业务异常: code={}, message={}", e.getCode(), e.getMessage());
        return R.fail(e.getCode(), e.getMessage());
    }
    
    @ExceptionHandler(SQLException.class)
    public R<Void> handleSQLException(SQLException e) {
        log.error("数据库异常: {}", e.getMessage(), e);
        return R.fail("SQL-EXEC-001", "数据库操作失败");
    }
}
```

### 2. 错误抛出

```java
// ✅ 推荐：使用自定义异常
public class BusinessException extends RuntimeException {
    private String code;
    private String message;
    
    public BusinessException(String code, String message) {
        super(message);
        this.code = code;
        this.message = message;
    }
}

// 使用示例
if (book == null) {
    throw new BusinessException("CODE-DATA-001", "图书不存在");
}
```

### 3. 错误日志

```java
// ✅ 推荐：记录详细的错误信息
log.error("错误码: {}, 错误信息: {}, 上下文: {}", 
    errorCode, 
    errorMessage, 
    context,
    exception
);
```

### 4. 错误响应

```json
{
  "code": "DEV-SQL-001",
  "message": "数据库连接失败",
  "data": null,
  "timestamp": "2026-01-29T15:30:45Z",
  "path": "/library/book/list",
  "traceId": "a1b2c3d4-e5f6-7890"
}
```

---

## 🔧 自定义错误码

### 添加新错误码步骤

1. **确定错误分类**
   - 选择合适的模块前缀（DEV/GIT/SQL等）
   - 选择合适的错误类型（CONN/EXEC/OPER等）

2. **分配错误码编号**
   - 在对应类型下找到下一个可用编号
   - 确保编号不冲突

3. **定义错误信息**
   ```markdown
   | 错误码 | 错误信息 | 原因 | 解决方案 |
   |--------|---------|------|---------|
   | **YOUR-CODE-001** | 错误描述 | 原因说明 | 解决方法 |
   ```

4. **更新索引**
   - 在快速查询索引中添加关键词
   - 更新相关步骤的错误码列表

### 自定义错误码示例

```markdown
#### CUSTOM-BIZ-xxx: 自定义业务错误

| 错误码 | 错误信息 | 原因 | 解决方案 |
|--------|---------|------|---------|
| **CUSTOM-BIZ-001** | 图书库存不足 | 借阅数量超过库存 | 减少借阅数量或等待归还 |
| **CUSTOM-BIZ-002** | 用户借阅超限 | 借阅数量超过限制 | 归还部分图书后再借阅 |
| **CUSTOM-BIZ-003** | 图书已被预约 | 图书被其他用户预约 | 等待预约取消或选择其他图书 |
```

---

## 📊 错误码统计（当前会话）

### 错误发生统计

```markdown
本次开发会话错误统计:

总错误次数: 5次
已解决: 4次
待解决: 1次

错误分布:
- SQL错误: 2次 (40%)
- 编译错误: 2次 (40%)
- Git错误: 1次 (20%)

最常见错误:
1. SQL-EXEC-001: SQL语法错误 (2次)
2. CODE-COMP-001: Java编译错误 (2次)
```

**注意**: 此统计仅显示当前会话的错误，**不生成历史统计文档**

---

## 🔗 相关文档

- **[回滚决策树](./dev-rollback-guide.md)** - 错误处理和回滚策略
- **[常见问题](./dev-faq.md)** - 常见问题解答
- **[详细步骤](./dev-steps.md)** - 各步骤详细说明

---

## 📝 注意事项

### ✅ 错误码使用规范

1. **统一使用标准错误码**
   - 不要自定义随意的错误码
   - 遵循错误码命名规范

2. **错误信息要清晰**
   - 描述准确的错误原因
   - 提供可行的解决方案

3. **记录详细的上下文**
   - 包含文件名、行号
   - 记录相关参数和状态

4. **及时更新错误码文档**
   - 新增错误码要更新文档
   - 废弃的错误码要标记

### ❌ 不生成历史总结文档

- ✅ 只显示当前会话的错误统计
- ✅ 只记录当前开发的错误日志
- ❌ **不生成**跨会话的错误历史
- ❌ **不生成**错误趋势分析文档
- ❌ **不生成**长期错误统计报告

---

## 🚀 快速开始

### 遇到错误时

1. **查看错误码**
   ```
   错误: DEV-SQL-001 - 数据库连接失败
   ```

2. **在本文档中搜索**
   - Ctrl+F 搜索 "DEV-SQL-001"
   - 或查看 [数据库连接错误](#sql-conn-xxx-数据库连接错误)

3. **查看解决方案**
   - 阅读错误原因
   - 按照解决方案操作

4. **仍未解决**
   - 查看 [常见问题](./dev-faq.md)
   - 或查看 [回滚决策树](./dev-rollback-guide.md)

---

**祝你开发顺利！** 🎉
