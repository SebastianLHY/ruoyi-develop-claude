# ❓ 常见问题与优化建议

> **用途**: 9个常见问题的解决方案  
> **最后更新**: 2026-01-29

---

## Q1: 如何判断是否需要新建模块？

**判断标准**：
- 业务领域独立（如订单、库存、运动健康等）→ 新建模块 `ruoyi-business-[业务名]`
- 属于系统管理功能（用户、角色、菜单等）→ 使用 `ruoyi-system`
- 仅为演示或测试功能 → 使用 `ruoyi-demo`

**模块命名建议**：
- 推荐格式：`ruoyi-business-[业务名]`（如 `ruoyi-business-order`、`ruoyi-business-inventory`）
- 保持命名一致性，便于项目维护

**示例**：
| 功能 | 建议模块 | 理由 |
|------|---------|------|
| 用户管理 | ruoyi-system | 系统管理功能 |
| 订单管理 | ruoyi-business-order | 业务领域独立 |
| 测试功能 | ruoyi-demo | 演示或测试 |
| 运动记录 | ruoyi-business-health | 业务领域独立 |
| 库存管理 | ruoyi-business-inventory | 业务领域独立 |

---

## Q2: 文档初始化后发现需求变更怎么办？

**处理方式**：
1. 立即更新 `docs/需求文档.md`
2. 重新评估技术设计（步骤2）
3. 更新 `docs/项目状态.md` 中的任务清单
4. 在 Git 提交时注明需求变更原因

**示例流程**：
```bash
# 1. 更新需求文档
# 编辑 docs/需求文档.md

# 2. 重新评估技术设计
# 如需修改表结构，更新步骤2的设计方案

# 3. 更新项目状态
# 编辑 docs/项目状态.md，记录变更原因

# 4. 提交变更
git add docs/
git commit -m "docs: 需求变更 - 增加XX字段"
```

---

## Q3: 测试验证阶段发现Bug怎么处理？

**处理流程**：
1. 激活 `bug-detective` 技能进行问题定位
2. 修复代码后重新运行测试
3. 在 `docs/项目状态.md` 中记录Bug和修复方案
4. 单独提交一次 Git Commit（类型：fix）

**示例**：
```bash
# 1. 定位问题
# 使用 bug-detective 技能分析日志和堆栈信息

# 2. 修复代码
# 修改相关文件

# 3. 重新测试
mvn test

# 4. 记录到文档
# 编辑 docs/项目状态.md

# 5. 提交修复
git add .
git commit -m "fix: 修复用户登录时空指针异常"
```

---

## Q4: 如何提高开发效率？

**优化建议**：
1. **步骤1-2合并执行**（边澄清需求边设计方案）
   - 节省时间：约20%
   - 适用场景：需求相对明确的情况
   
2. **步骤5-6并行**（数据库设计完成后立即生成Entity）
   - 节省时间：约15%
   - 适用场景：表结构确定后

3. **使用代码生成器**（若依自带的代码生成功能）
   - 节省Token：约40%
   - 节省时间：约50%
   - 适用场景：标准CRUD功能

4. **前端页面基于现有模板快速改造**
   - 节省时间：约30%
   - 适用场景：页面布局相似的功能

**效率对比**：
| 方式 | 时间消耗 | Token消耗 | 适用场景 |
|------|---------|----------|---------|
| 标准流程 | 100% | 100% | 所有场景 |
| 合并步骤1-2 | 80% | 95% | 需求明确 |
| 使用代码生成器 | 50% | 60% | 标准CRUD |
| 复用模板 | 70% | 70% | 相似功能 |

---

## Q5: Token消耗过大怎么办？

**优化策略**（按效果排序）：

### 1. 使用若依代码生成器（步骤2.5）⭐⭐⭐⭐⭐
- ✅ 效果最佳：可节省约40%整体Token消耗
- ✅ 适用场景：标准CRUD功能
- ⚠️ 需要：用户手动操作代码生成器

### 2. 分批执行 ⭐⭐⭐⭐
- 先完成步骤1-6（后端），再执行步骤7（前端）
- 可节省约20% Token（避免上下文重复加载）

### 3. 跳过已完成步骤 ⭐⭐⭐
- 如果项目已有Git管理，跳过步骤3的初始化部分
- 如果文档已存在，跳过步骤4

### 4. 使用精简模式 ⭐⭐
- 对于简单CRUD功能，可以省略测试代码生成（步骤8）
- 对于原型验证项目，可以暂时跳过步骤9（质量检查）

### 5. 复用现有代码 ⭐⭐⭐⭐⭐
- 参考项目中已有的类似功能，复制并修改
- 比完全重新生成节省约50% Token

**Token消耗对比**：
| 策略 | Token节省 | 实施难度 | 推荐度 |
|------|----------|---------|--------|
| 代码生成器 | 40% | 低 | ⭐⭐⭐⭐⭐ |
| 复用代码 | 50% | 中 | ⭐⭐⭐⭐⭐ |
| 分批执行 | 20% | 低 | ⭐⭐⭐⭐ |
| 跳过步骤 | 10% | 低 | ⭐⭐⭐ |
| 精简模式 | 15% | 中 | ⭐⭐ |

---

## Q6: 为什么要先Git初始化再文档初始化？

**原因说明**：
- 早期流程：文档初始化在Git初始化前，可能导致文档提交到错误分支
- 调整后流程：确保文档从一开始就在功能分支上

**好处**：
- ✅ 避免文档污染主分支
- ✅ 功能分支包含完整的需求和开发记录
- ✅ 代码审查时可以同时审查文档

**流程对比**：
```
早期流程（错误）:
步骤3: 文档初始化（在main分支）
步骤4: Git初始化（创建feature分支）
问题: 文档在main分支，代码在feature分支

调整后流程（正确）:
步骤3: Git初始化（创建feature分支）
步骤4: 文档初始化（在feature分支）
优势: 文档和代码都在feature分支
```

---

## Q7: 代码质量检查失败怎么办？

**处理策略**：

### 1. Critical 问题（阻断）🔴
- **处理方式**：必须立即修复，不允许继续
- **修复后**：重新执行步骤9
- **示例**：
  - 空指针异常
  - SQL注入漏洞
  - 死循环

### 2. Major 问题（警告）🟡
- **处理方式**：评估影响，优先修复重要问题
- **可接受标准**：< 5个问题继续提交
- **未修复问题**：记录到待办清单
- **示例**：
  - 方法复杂度过高
  - 代码重复
  - 命名不规范

### 3. Minor 问题（优化）🟢
- **处理方式**：记录到待办清单
- **修复时机**：在后续迭代中优化
- **示例**：
  - 注释不完整
  - 日志级别不当
  - 代码格式问题

### 4. 依赖漏洞 ⚠️
- **高危漏洞**：必须升级或替换依赖
- **中危漏洞**：评估是否影响当前使用场景
- **低危漏洞**：记录并计划升级

**处理流程图**：
```
代码质量检查
    ↓
发现问题
    ↓
├─ Critical → 立即修复 → 重新检查
├─ Major → 评估影响 → 修复重要问题 → 记录其他
├─ Minor → 记录到待办清单 → 后续优化
└─ 依赖漏洞 → 按危险等级处理
```

---

## Q8: 某个步骤失败了怎么办？

⚠️ **重要**: 本FAQ提供快速参考，**完整的回滚决策树和异常处理流程请参见**：  
📖 **[dev-rollback-guide.md](./dev-rollback-guide.md)** - P0改进文档 🆕

---

### 快速参考（简化版）

| 失败步骤 | 常见原因 | 回滚级别 | 详细处理 |
|---------|---------|---------|---------|
| **步骤1** | 需求不明确 | L1 轻微 | [查看详细处理](./dev-rollback-guide.md#步骤1失败需求澄清) |
| **步骤2** | 技术方案错误 | L1-L3 | [查看详细处理](./dev-rollback-guide.md#步骤2失败技术设计) |
| **步骤3** | Git初始化失败 | L1 轻微 | [查看详细处理](./dev-rollback-guide.md#步骤3失败git初始化) |
| **步骤5** | SQL执行失败 | L1-L2 | [查看详细处理](./dev-rollback-guide.md#步骤5失败数据库设计) |
| **步骤5.5** | 生成器配置错误/超时 | L1 轻微 | [查看详细处理](./dev-rollback-guide.md#步骤55失败代码生成方式选择) |
| **步骤6** | 代码编译/审查失败 | L1-L3 | [查看详细处理](./dev-rollback-guide.md#步骤6失败后端开发) |
| **步骤8** | 测试失败 | L1-L2 | [查看详细处理](./dev-rollback-guide.md#步骤8失败测试验证) |
| **步骤9** | 质量检查不通过 | L1-L2 | [查看详细处理](./dev-rollback-guide.md#步骤9失败代码质量检查) |
| **步骤11** | Git提交冲突/失败 | L1-L2 | [查看详细处理](./dev-rollback-guide.md#步骤11失败git提交) |

---

### 回滚级别说明

| 级别 | 描述 | 影响范围 | 用户确认 |
|------|------|---------|---------|
| **L1 - 轻微** | 仅回滚当前步骤 | 单个文件或配置 | ✅ 必需 |
| **L2 - 中等** | 回滚到上一步骤 | 多个文件 | ✅ 必需 |
| **L3 - 重大** | 回滚到设计阶段 | 整个模块 | ✅ 必需 + 原因说明 |
| **L4 - 完全** | 重置整个流程 | 所有代码和文档 | ✅ 必需 + 二次确认 |

---

### 智能体异常处理（NEW）

#### 智能体调用超时
```yaml
超时配置：
  单次调用: 30秒
  重试次数: 3次
  重试间隔: 1s, 2s, 4s（指数退避）
  
超时后降级：
  @code-reviewer 超时 → 人工审查清单
  @test-engineer 超时 → 基础测试框架
  @quality-inspector 超时 → 人工检查清单
  @bug-detective 超时 → 基础调试建议
```

📖 **详细处理**: [智能体异常处理](./dev-rollback-guide.md#智能体异常处理)

#### 智能体协作失败
```markdown
场景1: @code-generator → @code-reviewer失败
→ 降级到人工审查清单
→ 提供审查要点

场景2: 步骤8 → 步骤9数据传递失败
→ 重新生成报告
→ 独立执行检查
```

📖 **详细处理**: [智能体协作失败](./dev-rollback-guide.md#智能体协作失败)

---

### 常见场景快速跳转

1. **[代码生成后发现表结构错误](./dev-rollback-guide.md#场景1-代码生成后发现表结构设计错误)**
2. **[测试失败，多次修复仍无法通过](./dev-rollback-guide.md#场景2-测试失败多次修复仍无法通过)**
3. **[质量检查发现大量问题](./dev-rollback-guide.md#场景3-质量检查发现大量问题)**
4. **[Git提交后发现遗漏关键功能](./dev-rollback-guide.md#场景4-git提交后发现遗漏关键功能)**

---

### 通用回滚命令（精简版）

```bash
# Git回滚（未提交）
git checkout -- .           # 回滚所有修改
git clean -fd               # 删除未跟踪文件

# Git回滚（已提交未推送）
git reset --soft HEAD~1     # 保留修改
git reset --hard HEAD~1     # 丢弃修改

# 数据库回滚
DROP TABLE IF EXISTS <表名>;

# 文件备份与删除
mkdir -p backup/$(date +%Y%m%d_%H%M%S)
cp -r <目录> backup/$(date +%Y%m%d_%H%M%S)/
rm -rf <目录>
```

📖 **完整命令库**: [回滚执行命令](./dev-rollback-guide.md#回滚执行命令)

---

### ⚠️ 回滚前必读检查清单

```markdown
□ 1. 用户明确确认回滚操作
□ 2. 数据备份完成
□ 3. 影响范围明确
□ 4. 回滚命令准备
□ 5. 恢复计划明确
□ 6. 文档记录准备
□ 7. 团队协调（如需要）
```

📖 **完整清单**: [回滚检查清单](./dev-rollback-guide.md#回滚检查清单)

---

### 📚 扩展阅读

想要了解更多？查看完整的回滚决策树文档：

- 📖 **[完整回滚决策树](./dev-rollback-guide.md)** - 12步骤完整回滚策略
- 🗺️ **[回滚决策矩阵](./dev-rollback-guide.md#回滚决策矩阵)** - 快速决策表
- 🔧 **[分步骤回滚指南](./dev-rollback-guide.md#分步骤回滚指南)** - 详细处理流程
- 🤖 **[智能体异常处理](./dev-rollback-guide.md#智能体异常处理)** - 7个智能体的异常处理
- 💻 **[回滚执行命令](./dev-rollback-guide.md#回滚执行命令)** - Git/数据库/文件命令库
- 🎯 **[常见场景处理](./dev-rollback-guide.md#常见场景处理)** - 4个典型场景完整流程

---

## Q9: 新建模块时 pom.xml 未创建怎么办？

**现象**：
- 新建业务模块后，发现 pom.xml 文件不存在
- Maven 无法识别该模块
- 编译时报错找不到模块

**原因**：
- 步骤执行时遗漏了 pom.xml 创建步骤
- **多模块并行创建时容易遗漏**

**处理机制**：

系统会在代码生成前自动检查并补充创建：

```
前置检查（自动执行）：
1. 检查模块 pom.xml 是否存在
2. 如不存在 → 自动创建标准 pom.xml
3. 检查父 pom.xml 是否已注册模块
4. 如未注册 → 自动添加模块引用
5. 验证通过后才继续生成代码
```

**多模块创建规则**：
```
如需创建多个新模块：
1. 必须逐个创建，不可并行处理
2. 完成流程：目录结构 → pom.xml → 父pom注册 → 验证
3. 完成一个模块后再开始下一个
4. 每个模块都执行完整的前置检查
```

**手动修复方式**：

```
请检查 ruoyi-modules/[模块名]/pom.xml 是否存在，
如不存在，请立即创建标准 pom.xml 并更新父 pom.xml
```

执行步骤：
1. 创建模块 pom.xml（包含必需依赖）
2. 更新父 pom.xml 注册模块
3. 验证配置是否正确

**预防措施**：
- 系统在步骤6开始前增加强制检查
- code-generator 会自动验证
- 如有缺失会立即补充创建
- **创建多个模块时采用分批次顺序创建**

---

## 💡 最佳实践总结

### 效率优化
1. ⭐⭐⭐⭐⭐ 使用代码生成器（节省40% Token）
2. ⭐⭐⭐⭐⭐ 复用现有代码（节省50% Token）
3. ⭐⭐⭐⭐ 分批执行（节省20% Token）

### 质量保障
1. ⭐⭐⭐⭐⭐ 步骤8测试验证（覆盖率>80%）
2. ⭐⭐⭐⭐⭐ 步骤9质量检查（无Critical问题）
3. ⭐⭐⭐⭐ 步骤10文档同步（保持一致性）

### 风险管理
1. ⭐⭐⭐⭐⭐ 模块归属前置（步骤2确定）
2. ⭐⭐⭐⭐ Git分支隔离（步骤3创建）
3. ⭐⭐⭐⭐ 回滚机制（Q8参考）
4. ⭐⭐⭐⭐⭐ 智能代码复查（Q9，用户自行修改时）
5. ⭐⭐⭐⭐⭐ 模块配置自动检查（Q10，pom.xml自动创建）
